<!DOCTYPE html>
<html>
<head>

<title>Anderson Final Project</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
     <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://anderbar68.github.io/LA558/classes/Leaflet.awesome-markers-master/dist/leaflet.awesome-markers.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
    

<script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous">
  </script>

  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://indicator.extension.iastate.edu/classes/leaflet-ajax-gh-pages/dist/leaflet.ajax.min.js"></script>
  <script src="https://anderbar68.github.io/LA558/classes/Leaflet.awesome-markers-master/dist/leaflet.awesome-markers.js"></script>
</head>

<style>
   H2 {color:#272727;
     margin-bottom: 0px;
     text-align: center;
   }
   
   #map {
     width: 660px;
     height: 800px;
     margin-bottom: 20px;
  }
    .legend {
    line-height: 21px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 20px;
    float: left;
    margin-right: 8px;
    opacity: 0.8;
}
    .info {
        padding: 6px 8px;
        font: 10px/20px Arial, Helvetica, sans-serif;
        background: rgba(255,255,255,0.8);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 5px;
    }
    body {
      background-color: #eee;
    }
    hr {
      margin-bottom: 12px;
      margin-top: 12px;
    }
    .panel-info {
    border-color: #c8c8c8;
    }
</style>

<body>
  <div class="bg-primary util-padding-10">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
         <h1>Chicago Public Libraries <img src="img/cplLogo.PNG" class=" pull-right" width="6%" height="6%" style="margin-bottom:10px;"></h1>
       </div>
     </div>
   </div>
 </div>
 <div class="bg-info util-padding-10" style="margin-bottom:20px;">
  <div class="container">
    <div class="row">
      <div class="col-sm-12 text-muted">
        <small><h3 style="margin-left: 14px;">LA 558 | Final Project</h3></small>
      </div>
    </div>
  </div>
</div>
<div class="container">
 <div class="row">
  <div class="col-md-7">
    <div id="map"></div>
    <div class="panel panel-info">
      <div class="panel-body">
        <h3 style="margin-top:-5px;" class="">Chicago Public Libraries</h3>
        <p>Clicking the library icon will indicate hours and location of each library, and clicking the map tile in the left-corner of the map will alternate views of current traffic and satellite data.</p>
        <p>All locations provide innovative library services, technologies, and tools Chicagoans need to reach their goals. For more information see the <a href="https://www.chipublib.org/about-us/">Chicago Public Library</a> site.</p>
      </div>
    </div>
  </div><!--end col 7-->
  <div class="col-md-5 pull-right">
    <div class="panel panel-info">
      <div class="panel-body">
        <h3 style="margin-top:-5px;" class="">History of this data</h3>
        <p>The Chicago Public Library (CPL) is a public library system made up 80 locations distributed throughout Chicago's 77 community neighborhood areas. The CPL holds 5,721,334 volumes making it the 9th largest public library in the US by volumes &ndash; a pretty large feat considering the devastation that occurred to libraries as a result of the Great Chicago Fire in 1871. </p>
        <p>Chicago is made up of 9 different "sides", and divided by 77 officially recognized areas. This is distinct from neighborhoods, as community areas include many neighborhoods.</p>
      </div>
    </div>
    <div class="panel panel-info" style="">
      <div class="panel-body">
       <div class="row">
         <div class="col-sm-12 " style="margin-bottom: 20px;">
          <h3 style="margin-top:-5px;" class="">View data</h3>
          <small><label class="control-label">View libraries by community:</label></small>
          <select class="form-control" id="viewNeighborhood">
           <option id="nothing">Select Community</option>
           <option value="41.97, -87.72">Albany Park Community</option>
           <option value="41.81, -87.73">Archer Heights Community</option>
           <option value="41.833333, -87.633333">Armour Square Community</option>
           <option value="41.75, -87.71">Ashburn Community</option>
           <option value="41.74, -87.66">Ashburn Gresham Community</option>
           <option value="41.9, -87.76">Austin Community</option>
           <option value="41.75, -87.59">Avalon Park Community</option>
           <option value="41.94, -87.71">Avondale Community</option>
           <option value="41.93, -87.76">Belmont Cragin Community</option>
           <option value="41.71, -87.68">Beverly Community</option>
           <option value="41.84, -87.65">Bridgeport Community</option>
           <option value="41.82, -87.7">Brighton Park Community</option>
           <option value="41.73, -87.6">Burnside Community</option>
           <option value="41.74, -87.611667">Chatham Community</option>
           <option value="41.728333, -87.579722">Calumet Heights Community</option>
           <option value="41.77, -87.69">Chicago Lawn Community</option>
           <option value="41.78, -87.76">Clearing Community</option>
           <option value="41.83, -87.62">Douglas Community</option>
           <option value="41.95, -87.81">Dunning Community</option>
           <option value="41.88, -87.7">East Garfield Park Community</option>
           <option value="41.7, -87.56">East Side Community</option>
           <option value="41.99, -87.66">Edge Water Community</option>
           <option value="42.01, -87.81">Edison Park Community</option>
           <option value="41.779786, -87.644778">Englewood Community</option>
           <option value="41.983333, -87.75">Forest Glen Community</option>
           <option value="41.81, -87.626667">Fuller Park Community</option>
           <option value="41.79, -87.69">Gage Park Community</option>
           <option value="41.81, -87.62">Garfield Ridge Community</option>
           <option value="41.81, -87.62">Grand Boulevard Community</option>
           <option value="41.76, -87.61">Greater Grand Crossing Community</option>
           <option value="41.66, -87.55">Hegewisch Community</option>
           <option value="41.92, -87.73">Hermosa Community</option>
           <option value="41.88, -87.7">Humboldt Park Community</option>
           <option value="41.8, -87.59">Hyde Park Community</option>
           <option value="41.95, -87.73">Irving Park Community</option>
           <option value="41.98, -87.77">Jefferson Park Community</option>
           <option value="41.81, -87.6">Kenwood Community</option>
           <option value="41.94352, -87.654102">Lake View Community</option>
           <option value="41.95, -87.64">Lincoln Park Community</option>
           <option value="41.97, -87.69">Lincoln Square Community</option>
           <option value="41.928333, -87.706667">Logan Square Community</option>
           <option value="41.883333, -87.633333">Loop Community</option>
           <option value="41.85, -87.66">Lower West Side Community</option>
           <option value="41.83, -87.67">McKinley Park Community</option>
           <option value="41.93, -87.8">Montclare Community</option>
           <option value="41.69, -87.67">Morgan Park Community</option>
           <option value="41.7, -87.71">Mount Greenwood Community</option>
           <option value="41.9, -87.63">Near North Side Community</option>
           <option value="41.85, -87.62">Near South Side Community</option>
           <option value="41.87, -87.67">Near West Side Community</option>
           <option value="41.81, -87.66">New City Community</option>
           <option value="41.95, -87.68">North Center Community</option>
           <option value="41.86, -87.71">North Lawndale Community</option>
           <option value="41.95, -87.68">North Park Community</option>
           <option value="41.98, -87.8">Norwood Park Community</option>
           <option value="41.82, -87.6">Oakland Community</option>
           <option value="42, -87.92">Ohare Community</option>
           <option value="41.95, -87.76">Portage Park Community</option>
           <option value="41.71, -87.62">Pullman Community</option>
           <option value="42.01, -87.67">Riverdale Community</option>
           <option value="42.01, -87.67">Rogers Park Community</option>
           <option value="41.71, -87.62">Roseland Community</option>
           <option value="41.74, -87.55">South Chicago Community</option>
           <option value="41.71, -87.56">South Deering Community</option>
           <option value="41.85, -87.71">South Lawndale Community</option>
           <option value="41.76, -87.58">South Shore Community</option>
           <option value="41.97, -87.66">Uptown Community</option>
           <option value="41.72, -87.65">Washington Heights Community</option>
           <option value="41.79, -87.62">Washington Park Community</option>
           <option value="41.88, -87.73">West Garfield Park Community</option>
           <option value="41.79, -87.72">West Elsdon Community</option>
           <option value="41.78, -87.67">West Englewood Community</option>
           <option value="41.77, -87.72">West Lawn Community</option>
           <option value="41.68, -87.63">West Pullman Community</option>
           <option value="42, -87.69">West Ridge Community</option>
           <option value="41.9, -87.68">West Town Community</option>
         </select>
       </div>

       <div class="col-sm-12 " >
        <small><label class="control-label">Zoom to popular libraries:</label></small><br>
        <div class="">
          <button type="button" class="btn btn-primary" id="largest" style="margin-bottom:10px;">Oldest Library</button>
          <button type="button" class="btn btn-primary" id="style" style="margin-bottom:10px;">Most Beautiful Library (rated 2016)</button><br>
          <button type="button" class="btn btn-link" id="reset" style="margin-bottom:0px;">Reset Zoom</button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="panel panel-info" style="">
  <div class="panel-body">
    <div class="row">
      <div class="col-sm-12">
        <h3 class="" style="margin-top:-5px;">Walk Score</h3>
        <p>Click anywhere on the map (not directly on markers) to find out the walkability of the libraries near you.</p>
        <div class="col-sm-3 ">
          <small><label class="control-label">Walk Score</label></small>
          <h4><div id='myReponse'>&ndash;</div></h4>
        </div>
        <div class="col-sm-6 ">
          <small><label class="control-label">Walkability</label></small>
          <h4><div id='myReponse2'>&ndash;</div></h4>
        </div>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-sm-3 text-center">
        <h5 class="">90-100</h5>
      </div>
      <div class="col-sm-9">
        <h5 class="pull-left">Walker's Paradise, no car is needed</h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3 text-center">
        <h5>70-89</h5>
      </div>
      <div class="col-sm-9">
        <h5>Very Walkable, most traveling can be done on foot</h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3 text-center">
        <h5>50-69</h5>
      </div>
      <div class="col-sm-9">
        <h5>Somewhat Walkable, some traveling can be done on foot</h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3 text-center">
        <h5>25-49</h5>
      </div>
      <div class="col-sm-9">
        <h5 class="pull-left">Car Dependent, most Travel requires a car</h5>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3 text-center">
        <h5>0-24</h5>
      </div>
      <div class="col-sm-9">
        <h5>Car Dependent, almost all travel requires a car</h5>
      </div>
    </div>
  </div>
</div>

</div>

</div><!--end row-->
<footer>
  <div class="row">
    <div class="col-lg-12">
      <p>Bailey Anderson 2017 | <a href="https://anderbar68.github.io/LA558/finalProject/finalProject.pptx">Project Summary <i class="fa fa-file-powerpoint-o" aria-hidden="true"></i></a></p>
    </div>
  </div>
  <!-- /.row -->
</footer>
</div>
</body>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
    $(document).ready(function() {
        var data;
        // Base Layers
        var OSM = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18
        });
        var traffic = L.tileLayer('https://api.mapbox.com/styles/v1/anderbar/cj1s938td000s2snwqi7p4tlf/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYW5kZXJiYXIiLCJhIjoiY2oxY3U4MWRsMDA2ZjJ6cGRkc2Rnbnk0dCJ9.HMKO48WdOuov0_6EdnQfKA', {
            attribution: 'Bailey - Traffic'
        });
        var sat = L.tileLayer('https://api.mapbox.com/styles/v1/anderbar/cj1s9loja000x2st26kz3v2vd/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYW5kZXJiYXIiLCJhIjoiY2oxY3U4MWRsMDA2ZjJ6cGRkc2Rnbnk0dCJ9.HMKO48WdOuov0_6EdnQfKA', {
            attribution: 'Bailey - Satellite'
        });

        // Create map
        var map = L.map('map', {
            center: new L.LatLng(41.836944, -87.684722),
            zoom: 11,
            layers: [OSM]
        });
        //load data 
        myURL = 'https://anderbar68.github.io/LA558/finalProject/library.geojson';
        var libIcon = L.AwesomeMarkers.icon({
            prefix: 'fa', //font awesome
            markerColor: 'lightgray', 
            icon: 'fa-university' //http://fortawesome.github.io/Font-Awesome/icons/
        });

        var geojsonLayer = new L.GeoJSON.AJAX(myURL, {
            pointToLayer: function(feature, latlng) {
                return L.marker(latlng, {
                    icon: libIcon
                }).on('click', function() {
                    this.bindPopup("<strong>" + feature.properties.name + " Library </strong> <br>" + feature.properties.address + "<br><strong>Hours:</strong> <br>M - </strong>" + feature.properties.hours.m + "<br>Tu - " + feature.properties.hours.tu + "<br>W - " + feature.properties.hours.w + "<br>Th - " + feature.properties.hours.th + "<br>F - " + feature.properties.hours.f + "<br>Sat - " + feature.properties.hours.sa + "<br>Sun - " + feature.properties.hours.su).openPopup();
                });
            }

        }).addTo(map);

        myURL2 = 'https://anderbar68.github.io/LA558/finalProject/boundary.geojson';

        function style2(feature) {
            return {
                fillColor: false,
                weight: 2,
                opacity: 1,
                color: '#2F4F4F',
                dashArray: '1',
                fillOpacity: 0
            };
        }
        var geojsonLayer3 = new L.GeoJSON.AJAX(myURL2, {
            style: style2
        }).addTo(map);
        //set color of marker
        function getColor(d) {
            return (d == '8') || (d == '32') || (d == '33') ? '#87CEEB' : //central 

                (d == '5') || (d == '6') || (d == '7') || (d == '21') || (d == '22') ? "  #6495ED" : //north side

                (d == '1') || (d == '2') || (d == '3') || (d == '4') || (d == '9') || (d == '10') || (d == '11') || (d == '12') || (d == '13') || (d == '14') || (d == '76') || (d == '77') ? "#1E90FF" : //far north side

                (d == '15') || (d == '16') || (d == '17') || (d == '18') || (d == '19') || (d == '20') ? "#4169E1" : //northwest side

                (d == '23') || (d == '24') || (d == '25') || (d == '26') || (d == '27') || (d == '28') || (d == '29') || (d == '30') || (d == '31') ? "#00008B" : //west side

                (d == '34') || (d == '35') || (d == '36') || (d == '37') || (d == '38') || (d == '39') || (d == '40') || (d == '41') || (d == '42') || (d == '43') || (d == '60') || (d == '69') ? "#483D8B" : //south side

                (d == '56') || (d == '57') || (d == '58') || (d == '59') || (d == '61') || (d == '62') || (d == '63') || (d == '64') || (d == '65') || (d == '66') || (d == '67') || (d == '68') ? "#8A2BE2" : //southwest side

                (d == '44') || (d == '45') || (d == '46') || (d == '47') || (d == '48') || (d == '49') || (d == '50') || (d == '51') || (d == '52') || (d == '53') || (d == '54') || (d == '55') ? "#4B0082" : //far southeast side

                (d == '70') || (d == '71') || (d == '72') || (d == '73') || (d == '74') || (d == '75') ? "#8B008B" : //far southwest side
                "#FFFFFF"; //white
        }

        function style(feature) {
            return {
                fillColor: getColor(feature.properties.area_numbe),
                weight: 2,
                opacity: 1,
                color: '#2F4F4F',
                dashArray: '1',
                fillOpacity: 0.4
            };
        }
        var geojsonLayer2 = new L.GeoJSON.AJAX(myURL2, {
            style: style,
            onEachFeature: function(feature, layer) {
                layer.bindTooltip(feature.properties.community + "Community");
            }

        }).addTo(map);

        //Create Legend
        var legend = L.control({
            position: 'bottomleft'
        });
        legend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'info legend'),
                pop_size = [8, 5, 1, 15, 23, 34, 56, 44, 70],
                labels = ['Central', 'North Side', 'Far North side', 'Northwest side', 'West Side', 'South side', 'Southwest side', 'Far Southeast side', 'Far Southwest side'];

            div.innerHTML += "<strong>Sides of Chicago</strong><br>";
            // loop through items and generate a label with a colored square for each
            for (var i = 0; i < pop_size.length; i++) {
                div.innerHTML +=
                    '<i style="background:' + getColor(pop_size[i]) + ' "></i> ' +
                    labels[i] + '<br>';
            }
            return div;
        };
        legend.addTo(map);

        // Layer control
        var baseMaps = {
            "Open Street Map": OSM,
            "Traffic View": traffic,
            "Satellite View": sat,
        };

        var overlayMaps = {
            "'Sides' of Chicago": geojsonLayer2,
        };

        L.control.layers(baseMaps, overlayMaps).addTo(map);

        // Add and remove legend from layers when selected in control
        map.on('overlayremove', function(eventLayer) {
            console.log(eventLayer.name + " off");
            if (eventLayer.name == "'Sides' of Chicago") {
                this.removeControl(legend);
            }
        });
        map.on('overlayadd', function(eventLayer) {
            console.log(eventLayer.name + " on");
            if (eventLayer.name == "'Sides' of Chicago") {
                legend.addTo(this);
            }
        });
        //change neighborhood view
        $("#viewNeighborhood").change(function() {

            viewNew = $("#viewNeighborhood option:selected").val();
            console.log(viewNew);
            viewCommunity = viewNew.split(",");
            map.setView([viewCommunity[0], viewCommunity[1]], 15);

        });
        console.clear();


        var walkScoreKey = "bbc3438ece35cb6914cd26ad905147b1";

        address = '';

        var lat, lon;

        map.on('click', function(e) {
            newLocation = (e.latlng.lat + ", " + e.latlng.lng);

            myLat = e.latlng.lat;
            myLon = e.latlng.lng;
            console.log(newLocation);
            console.log(lat, lon);
            getWalkScore();
        });

        function getWalkScore() {
            url = "http://129.186.142.145/cjsTesting/walkScoreGrid/walkScoreLookupPOST.php";

            $.post(url, {
                    lat: myLat,
                    lon: myLon,
                    key: walkScoreKey,
                    address: address
                },
                function(response, status) {

                    //This is what actually gets returned from the PHP request and includes a status value. 
                    //console.log("Data: " + response + "\nStatus: " + status);
                    //To use this you have to parse the response as JSON via a jQuery script
                    var obj = $.parseJSON(response);

                    console.log(obj);

                    //You can now access the individual items as follows:
                    console.log("------------");
                    console.log("Status: " + obj.status);
                    console.log("Walkscore: " + obj.walkscore);
                    console.log("Description: " + obj.description);

                    $('#myReponse').html(obj.walkscore);
                    $('#myReponse2').html(obj.description);


                });
        }
        $('#largest').click(function() {
            map.setView([41.87632, -87.628219], 18);
        });

        $('#style').click(function() {
            map.setView([41.849753498689424, -87.63190001364559], 18);
        });

        $('#reset').click(function() {
            map.setView([41.836944, -87.684722], 11);
        });
    }); //end doc ready
</script>
</html>